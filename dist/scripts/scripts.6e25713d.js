"use strict";var users=function(a){return a.init=function(){a.$container=$("#container"),a.$userShowTemplate=$("#userShowTemplate"),a.user_path="https://agile-thicket-8420.herokuapp.com/users"},a}(users||{}),tournaments=function(a){return a.init=function(){a.$container=$("#container"),a.$allTournamentsTemplate=$("#allTournamentsTemplate"),a.list=$("ul#tourney-list"),a.tournaments_path="https://agile-thicket-8420.herokuapp.com/tournaments"},a}(tournaments||{}),images=function(a){return a.images_path="https://agile-thicket-8420.herokuapp.com/images",a.tournament_path="https://agile-thicket-8420.herokuapp.com/tournaments",a.init=function(){},a}(images||{}),environment=function(a){return a.host="https://agile-thicket-8420.herokuapp.com/",a.getParams=function(){var a=window.location.search,b=/\d+/;return b.exec(a)[0]},a}(environment||{});$(document).ready(function(){users.init(),tournaments.init(),images.init()});var users=function(a){return a.renderSignIn=function(){$("<div></div>").prependTo("body").attr("id","overlay");$("#signContainer").empty();var b=Handlebars.compile($("#signInTemplate").html());$("#signContainer").html(b({})),$("#signSubmit").click(function(b){b.preventDefault(),a.submitLogin()}),$("#signCancel").click(function(){a.removeModal()})},a.removeModal=function(){$("#overlay").remove(),$(".modal").remove()},a.submitLogin=function(){return $.ajax({url:a.user_path+"/sign_in",type:"POST",data:{name:$("#name").val(),password:$("#password").val()}}).done(function(b){a.loginSuccess(b)}).fail(function(a){console.log(a)}),!1},a.loginSuccess=function(b){localStorage.setItem("authToken",b.token),console.log("logged in!"),a.findUser(),a.removeModal(),environment.setUpNav()},a}(users||{});$(document).ready(function(){});var users=function(a){return a.renderSignUp=function(){$("<div></div>").prependTo("body").attr("id","overlay");$("#signContainer").empty();var b=Handlebars.compile($("#signUpTemplate").html());$("#signContainer").html(b({})),$("#signSubmit").click(function(b){b.preventDefault(),a.submitRegistration()}),$("#signCancel").click(function(){a.removeModal()})},a.submitRegistration=function(){return $.ajax({url:a.user_path,type:"POST",data:{user:{name:$("#name").val(),email:$("#email").val(),password:$("#password").val(),password_confirmation:$("#password-confirmation").val()}}}).done(a.loginSuccess).fail(function(a){console.log(a)}),!1},a}(users||{});$(document).ready(function(){$("form#registration-form").on("submit",users.submitRegistration)});var users=function(a){return a.findUser=function(b){localStorage.authToken&&(a.authToken=localStorage.authToken),$.ajaxPrefilter(function(b){b.headers={},b.headers.AUTHORIZATION=a.authToken}),$.ajax({url:users.user_path}).done(function(c){a.user=c,b&&b(c)}).fail()},a.show_user_page=function(){environment.emptyContainers(),$.ajaxPrefilter(function(b){b.headers={},b.headers.AUTHORIZATION=a.authToken}),a.findUser(a.renderUser)},a.renderUser=function(b){$.ajax({url:a.user_path+"/"+b.id}).done(function(b){a.render(b)}).fail()},a.render=function(b){var c=Handlebars.compile(a.$userShowTemplate.html());$("#openContainer").html(c({user:b}));var d=Handlebars.compile($("#userTournamentsTemplate").html());$("#closedContainer").html(d({tournaments:b.tournaments}));var e=Handlebars.compile($("#newTournamentTemplate").html());$("#openContainer").append(e({})),tournaments.renderFileUpload(),$("#submitNewTournament").click(tournaments.submitTournament),$(".delete").click(function(a){a.preventDefault(),tournaments.delete_a_tournament(this.id)}),$(".tournament").click(function(){tournaments.showTournament(this.id)})},a}(users||{});$(document).ready(function(){});var users=function(a){return a.sign_out=function(){localStorage.authToken="",a.user=void 0,location.reload()},a}(users||{});$(document).ready(function(){});var tournaments=function(a){return a.tournaments_page=function(b,c){environment.emptyContainers(),$.ajax({url:a.tournaments_path}).done(function(d){a.render(d,b,c)}).fail()},a.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},a.render=function(b,c,d){b=_.filter(b,function(a){return a.status==c}),b.status=a.capitalize(c)+" Tournaments";var e=Handlebars.compile(a.$allTournamentsTemplate.html());d?d.html(e({tournaments:b})):a.$container.html(e({tournaments:b})),$(".tournament").click(function(){tournaments.showTournament(this.id)})},a}(tournaments||{});$(document).ready(function(){});var tournaments=function(a){return a.each_slice=function(){var a=[1,2,3,4,5,6,7,8,9];_.chain(a).groupBy(function(a,b){return Math.floor(b/n)}).toArray().val()},a.renderStuff=function(){environment.emptyContainers();var b=Handlebars.compile($("#newTournamentTemplate").html());$("#closedContainer").html(b()),$("#openContainer").html("<p id=openMessage> You can create a tournament here. Fill in the question you want to ask and upload you images. Once they are all in hit the submit button.<br>At the moment we can only upload .jpg files. Please check back later to see if other files types are supported.</p>"),a.renderFileUpload(),$("#submitNewTournament").click(a.submitTournament)},a.renderFileUpload=function(){var a=Handlebars.compile($("#imageHeaderTemplate").html());$("#uploadContainer").append(a({})),$(".file").change(function(){tournaments.renderFileUpload(),$(this).prop("disabled",!0)})},a.submitTournament=function(b){b.preventDefault(),a.image_array=[],a.uploaded=0,a.$files=$(".file"),a.$files.splice(a.$files.length-1),a.$files.each(function(){images.prepareToSend($(this))})},a.prepareTournament=function(b){var c="https://s3.amazonaws.com/my-pixelect-bucket/"+b.key;a.image_array.push({url:c}),a.safeToCreate()},a.safeToCreate=function(){a.image_array.length===a.$files.length?users.findUser(tournaments.createTournament):console.log("not yet.")},a.createTournament=function(){a.createProgress(),$.ajax({url:a.tournaments_path,type:"POST",data:{tournament:{user_id:users.user.id,question:$("#question").val(),images_attributes:a.image_array}}}).done(function(){}).fail(function(){console.log("error")})},a.createProgress=function(){$("<div></div>").prependTo("body").attr("id","overlay");$("#signContainer").empty();var a=Handlebars.compile($("#progressTemplate").html());$("#signContainer").html(a({}))},a.updateProgress=function(){var b=Math.floor(a.uploaded/a.image_array.length*100);$("#completed").text(b+"%"),$("#progressBar").width(b),"100%"===$("#completed").text()&&(users.removeModal(),$("#signContainer").empty(),users.show_user_page())},a}(tournaments||{});$(document).ready(function(){});var tournaments=function(a){return a.each_slice=function(a){return _.chain(a).groupBy(function(a,b){return Math.floor(b/2)}).toArray()._wrapped},a.showTournament=function(b){environment.emptyContainers(),a.getTournament(b)},a.getTournament=function(b){$.ajax({url:a.tournaments_path+"/"+b.toString()}).done(function(b){a.active=b,"open"===b.status?(a.setup(),a.runTournament()):a.renderClosedTournament(b)}).fail(function(){console.log("error")})},a.setup=function(){a.array=a.active.images},a.runTournament=function(){a.count=0,a.array=_.flatten(a.array),a.array=_.shuffle(a.array),$("header h1").text(a.active.question),1===a.array.length?a.updateWinner(a.renderWinner):(a.array=a.each_slice(a.array),a.renderOpenTournament())},a.renderOpenTournament=function(){a.count===a.array.length||a.array[a.count].length<2?a.runTournament():a.renderPairing()},a.renderPairing=function(){var b={question:a.active.question,leftImage:a.array[a.count][0],rightImage:a.array[a.count][1]},c=Handlebars.compile($("#showLeftTemplate").html());$("#openContainer").html(c({tournament:b}));var c=Handlebars.compile($("#showRightTemplate").html());$("#closedContainer").html(c({tournament:b})),$("#leftImage").click(function(){a.array[a.count].pop(),a.count+=1,a.renderOpenTournament()}),$("#rightImage").click(function(){a.array[a.count].shift(),a.count+=1,a.renderOpenTournament()}),$(".leftFlag").click(function(b){b.preventDefault(),images.flagImage(this.id),a.array[a.count].shift(),a.count+=1,a.renderOpenTournament()}),$(".rightFlag").click(function(b){b.preventDefault(),images.flagImage(this.id),a.array[a.count].pop(),a.count+=1,a.renderOpenTournament()})},a.renderWinner=function(b){if(environment.emptyContainers(),b&&(a.active=b),a.active.winner=a.array[0],a.active.current=users.user,users.user&&users.user.id===a.active.user_id){var c=Handlebars.compile($("#showWinnerTournamentTemplate").html());$("#openContainer").html(c({tournament:a.active}));var d=Handlebars.compile($("#showWinnerCommentsTemplate").html());$("#closedContainer").html(d({tournament:a.active})),$("#commentSubmit").click(function(b){b.preventDefault(),comments.createWinnerComment(a.active)}),$(".subcomment").click(function(){comments.addSubcomment(this)})}else{var c=Handlebars.compile($("#showVisitorWinnerTournamentTemplate").html());$("#openContainer").html(c({tournament:a.active}));var d=Handlebars.compile($("#showVisitorWinnerCommentsTemplate").html());$("#closedContainer").html(d({tournament:a.active})),$("#commentSubmit").click(function(b){b.preventDefault(),comments.createWinnerComment(a.active)}),$(".subcomment").click(function(){comments.addSubcomment(this)})}},a.updateWinner=function(b){$.ajax({url:images.images_path+"/"+a.array[0].id+"/win",type:"POST"}).done(function(){b&&b()}).fail(function(){console.log("error")})},a.renderClosedTournament=function(b){if(b.current=users.user,users.user&&users.user.id===a.active.user_id){var c=Handlebars.compile($("#showClosedTournamentTemplate").html());$("#openContainer").html(c({tournament:b}));var d=Handlebars.compile($("#showClosedCommentsTemplate").html());$("#closedContainer").html(d({tournament:b})),$(".subcomment").click(function(){comments.addSubcomment(this)})}else{var c=Handlebars.compile($("#showVisitorClosedTournamentTemplate").html());$("#openContainer").html(c({tournament:b}));var d=Handlebars.compile($("#showVisitorClosedCommentsTemplate").html());$("#closedContainer").html(d({tournament:b}))}$("#commentSubmit").click(function(a){a.preventDefault(),comments.createComment(b)})},a}(tournaments||{});$(document).ready(function(){});var tournaments=function(a){return a.delete_a_tournament=function(b){$("<div></div>").prependTo("body").attr("id","overlay");$("#signContainer").empty();var c=Handlebars.compile($("#deleteTemplate").html());$("#signContainer").html(c({id:{target:b}})),$("#destroy").click(function(){a.actually_delete_a_tournament($("#target_id").val()),users.removeModal()}),$("#cancel").click(function(){users.removeModal()})},a.actually_delete_a_tournament=function(a){$.ajax({url:tournaments.tournaments_path+"/"+a,type:"DELETE"}).done(function(){users.removeModal(),users.show_user_page()})},a}(tournaments||{});$(document).ready(function(){});var images=function(a){return a.getImageKey=function(a,b){$.ajax({url:"https://agile-thicket-8420.herokuapp.com/amazon/sign_key",type:"GET"}).done(function(c){a(c,b)}).fail()},a.createImage=function(){$.ajax({url:a.images_path,type:"POST",data:{image:{url:"https://s3.amazonaws.com/my-pixelect-bucket/"+a.key,tournament_id:1}}}).done(function(){}).fail()},a.prepareToSend=function(b){var c=b[0].files[0];a.getImageKey(a.postRequests,c)},a.postRequests=function(b,c){a.amazonAjax(b,c),tournaments.prepareTournament(b)},a.test=function(){a.getImageKey(a.tryAjax)},a.amazonAjax=function(a,b){$.ajaxPrefilter(function(a){a.headers={},a.headers.Accept="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"});var c=new FormData;c.append("key",a.key),c.append("AWSAccessKeyId",a.access_key),c.append("policy",a.policy),c.append("signature",a.signature),c.append("Content-Type",b.type),c.append("file",b),$.ajax({url:"https://s3.amazonaws.com/my-pixelect-bucket",type:"POST",data:c,processData:!1,contentType:!1}).done(function(){console.log("sent to amazon"),tournaments.uploaded+=1,console.log(tournaments.uploaded),tournaments.updateProgress()}).fail(function(a){console.log(a),tournaments.uploaded+=1,tournaments.updateProgress()})},a}(images||{});$(document).ready(function(){});var images=function(a){return a.flagImage=function(a){$.ajax({url:images.images_path+"/"+a+"/flag",type:"POST"}).done(function(){console.log("image flagged")}).fail()},a}(images||{});$(document).ready(function(){});var comments=function(a){return a.createComment=function(a){$.ajax({url:"https://agile-thicket-8420.herokuapp.com/tournaments/"+a.id+"/comments",type:"POST",data:{comment:{body:$("#comment").val()+"--"+users.user.name,user_id:users.user.id}}}).done(function(a){tournaments.renderClosedTournament(a)}).fail()},a.createWinnerComment=function(a){console.log("here"),$.ajax({url:"https://agile-thicket-8420.herokuapp.com/tournaments/"+a.id+"/comments",type:"POST",data:{comment:{body:$("#comment").val()+"--"+users.user.name,user_id:users.user.id}}}).done(function(a){console.log(a),tournaments.renderWinner(a)}).fail(function(){console.log("err")})},a.addSubcomment=function(a){$.ajax({url:"https://agile-thicket-8420.herokuapp.com/comments/"+a.id,type:"PATCH",data:{comment:{subcomment:$(a).parent().find("textarea").val()}}}).done(function(a){tournaments.renderClosedTournament(a)}).fail()},a}(comments||{});$(document).ready(function(){});var environment=function(a){return a.setUpNav=function(){a.findUser(a.showCorrectButtons)},a.showCorrectButtons=function(){$("#tournamentDropNav").unbind(),$("#tournamentDropNav").hover(function(){$("#tournamentDropNav").find("ul").toggle()},function(){$("#tournamentDropNav").find("ul").toggle()}),a.user?($("#tournamentDropNav").show(),$("#signInNav").hide(),$("#signInNav").unbind(),$("#signUpNav").hide(),$("#signUpNav").unbind(),$("#signOutNav").show(),$("#signOutNav").click(function(){users.sign_out()}),$("#newTournamentNav").show(),$("#newTournamentNav").click(function(){tournaments.renderStuff()}),$("#tournamentOpenIndexNav").show(),$("#tournamentOpenIndexNav").click(function(){tournaments.tournaments_page("open",$("#closedContainer"));var a=Handlebars.compile($("#openDescriptionTemplate").html());$("#openContainer").html(a({}))}),$("#tournamentClosedIndexNav").show(),$("#tournamentClosedIndexNav").click(function(){tournaments.tournaments_page("closed",$("#closedContainer"));var a=Handlebars.compile($("#closedDescriptionTemplate").html());$("#openContainer").html(a({}))}),$("#userNav").show(),$("#userNav").click(function(){users.show_user_page()})):($("#tournamentDropNav").show(),$("#signInNav").show(),$("#signInNav").click(function(){users.renderSignIn()}),$("#signUpNav").show(),$("#signUpNav").click(function(){users.renderSignUp()}),$("#signOutNav").hide(),$("#signOutNav").unbind(),$("#newTournamentNav").hide(),$("#newTournamentNav").unbind(),$("#tournamentOpenIndexNav").show(),$("#tournamentOpenIndexNav").click(function(){tournaments.tournaments_page("open",$("#closedContainer"));var a=Handlebars.compile($("#openDescriptionTemplate").html());$("#openContainer").html(a({}))}),$("#tournamentClosedIndexNav").show(),$("#tournamentClosedIndexNav").click(function(){tournaments.tournaments_page("closed",$("#closedContainer"));var a=Handlebars.compile($("#closedDescriptionTemplate").html());$("#openContainer").html(a({}))}),$("#userNav").hide(),$("#userNav").unbind())},a.renderLandingPage=function(){$.ajax({url:tournaments.tournaments_path}).done(function(a){tournaments.render(a,"open",$("#openContainer")),tournaments.render(a,"closed",$("#closedContainer"))}).fail()},a.emptyContainers=function(){$("#container").empty(),$("#signContainer").empty(),$("#openContainer").empty(),$("#closedContainer").empty(),$("header h1").empty()},a}(users||{});$(document).ready(function(){environment.setUpNav(),environment.renderLandingPage()});